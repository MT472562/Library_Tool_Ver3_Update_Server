{% extends "base.html" %}
{% block head %}
<!-- <link rel="stylesheet" href="/Library/resources/style.css"> -->
<!-- ã‚¹ã‚¿ã‚¤ãƒ«ã‚·ãƒ¼ãƒˆèª­ã¿è¾¼ã¿ãªã•ã„ -->
{% endblock %}
{% block body %}
<!-- bodyã‚¿ã‚°ã«æ›¸ãå†…å®¹ã‚’æ›¸ããªã•ã„ -->
<div class="overlay" id="overlay" style="display:none">
    <button id="reload" onclick="reloadPage()">å†èª­ã¿è¾¼ã¿</button>
    <div class="loader">
        <div></div>
        <div></div>
        <div></div>
        <div></div>
    </div>
</div>
<div class="inventory_menu">
    <div class="new_inventory">
        <button id="new_take_inventory" onclick="new_inventory()">æ–°è¦æ£šå¸ã—</button>
        <hr>
    </div>
    <div class="inventory_about">
        <h3>æ£šå¸ã—ãƒ‡ãƒ¼ã‚¿ä¸€è¦§ã€€é™é †</h3>
        <table id="inventory_tabel">
            <thead>
            <tr>
                <th id="inventory_tabel_id">ID</th>
                <th id="inventory_tabel_name">åå‰</th>
                <th id="inventory_tabel_date">è¨­è¨ˆæ—¥ä»˜</th>
                <th id="inventory_tabel_last_update">æœ€çµ‚æ›´æ–°æ—¥</th>
                <th id="inventory_tabel_status">ãƒ­ãƒƒã‚¯çŠ¶æ…‹</th>
                <th>ç·¨é›†</th>
            </tr>
            </thead>
            <tbody>
            {% for item in data %}
            <tr>
                <td>{{ item[0] }}</td>
                <td>{{ item[1] }}</td>
                <td>{{ item[2] }}</td>
                <td>{{ item[4] }}</td>
                {% if item[3] == 1 %}
                <td style="color: #00c2ff">ğŸ”“ãƒ­ãƒƒã‚¯è§£é™¤</td>
                {% else %}
                <td style="color: #ff3c3c">ğŸ”ãƒ­ãƒƒã‚¯æ¸ˆã¿</td>
                {% endif %}
                {% if item[3] == 1 %}
                <td>
                    <button class="edit-button" onclick="edit('{{ item[5] }}')">ç·¨é›†</button>
                </td>
                {% else %}
                <td style="color: #ff3c3c" onclick="edit('{{ item[5] }}')" )>ç·¨é›†ä¸å¯</td>
                {% endif %}
            </tr>
            {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<script>
    function reloadPage() {
        window.location = "./inventory?s=true";
    }

    function edit(hash) {
        document.getElementById("overlay").style.display = "block";
        document.getElementById("reload").style.display = "none";
        for (let i = 5; i > 0; i--) {
            (function (count) {
                setTimeout(function () {
                    document.getElementById("count").innerHTML = count;
                }, (5 - count) * 1000);
            })(i);
        }

        var message = `ãƒªã‚¯ã‚¨ã‚¹ãƒˆå‡¦ç†ä¸­ã§ã™...\næ£šå¸ã—ãƒšãƒ¼ã‚¸ã«ã‚ã¨<span id="count">5</span>ç§’å¾Œã«ç§»å‹•ã—ã¾ã™ã€‚\nç§»å‹•ã—ãªã„å ´åˆã¯ã€<a href="/inventory/${hash}">ã“ã¡ã‚‰</a>ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ãã ã•ã„ã€‚`;
        top_alert("ã€æƒ…å ±ã€‘", message, 99999);
        setTimeout(function () {
            window.location = `/inventory/${hash}`;
        }, 5000);

    }

    function new_inventory() {
        const currentQuery = window.location.search;
        if (currentQuery === "?s=true") {
            top_alert("é‡è¦ãªç¢ºèª", "å…ˆç¨‹æ–°è¦ç™»éŒ²ã•ã‚ŒãŸæ¨¡æ§˜ã§ã™ãŒã€ä¸€è¦§ã«ç™»éŒ²ãƒ‡ãƒ¼ã‚¿ã¯ã‚ã‚Šã¾ã›ã‚“ã‹ï¼Ÿ", 5000);
            return
        } else {
            ;
        }
        var name = window.prompt("æ£šå¸ã®åå‰ã‚’è¿½åŠ ã—ã¦ãã ã•ã„", "");
        if (name === null) {
            // The user clicked the Cancel button
            top_alert("æƒ…å ±", "æ–°è¦æ£šå¸ã—ç™»éŒ²å‡¦ç†ã‚’ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã—ã¾ã—ãŸ", 5000);
            return;
        }

        if (name === "") {
            top_alert("ã‚¨ãƒ©ãƒ¼", "æ£šå¸ã®åå‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„", 5000);
            return;
        }
        document.getElementById("overlay").style.display = "block";
        data = {
            name: name
        };

        post_url = "/new_inventory";
        fetch(post_url, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(data)
        })
            .then(response => response.json())
            .then(statusData => {

                top_alert("ã€é‡è¦æƒ…å ±ã€‘", statusData, 8000);


            })
            .catch(error => console.error(error));


    }

</script>
{% endblock %}
